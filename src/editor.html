
<html><head><title>MapCSS editor with syntax highlighting</title>
  <link rel="stylesheet" href="leaflet/leaflet.css" />
  <link rel="stylesheet" type="text/css" href="jquery.notify.css" />
  <link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.10.3/themes/black-tie/jquery-ui.css" />
  <script src="leaflet/leaflet.js"></script>
  <script src="kothic/kothic.min.js"></script>
  <script src="kothic/kothic-leaflet.js"></script> 
  <script src="styles/osmosnimki.js"></script>
  
  <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>  
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
  <script src="jquery.notify.js"></script>
  <script src="config.js"></script>
</head>
<body>
<table width=100% height=100%>
  <tr>
    <td rowspan="2" width=50%>
      <div id="map" style="height:100%; width:100%"></div>
    </td>
    <td height=30>
      <button id="save">Submit</button>
    </td>
    <td width="60">
      <span id="status" align="right">&nbsp;</span>
    </td>
  </tr>
  <tr>
    <td valign="top" colspan="2">
      <div id="editor" style="height: 80%; width: 50%;" >  
canvas{fill-color:white}
way[highway]{color:red; width:3}
      </div>
    </td>
  </tr>
</table>

<script src="src/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="src/mode-mapcss.js" type="text/javascript" charset="utf-8"></script>
<script>
window.onload = function() {
    editor = ace.edit("editor");
    var MapcssMode = require("ace/mode/mapcss").Mode;
		editor.getSession().setMode(new MapcssMode());
		editor.getSession().on('change', function(){changed=true;});
};
</script>


<script>
    changed = false;

    
    var map = new L.Map('map', {
			center: new L.LatLng(startY, startX), // from config.js
			zoom: startZ
		});
    var kothic = new L.TileLayer.Kothic(vtileUrl, { //vtileUrl - from config.js
            minZoom: 3,
            styles: ['osmosnimki']
    });
    map.addLayer(kothic);
    

    function update_mapnik(lang) {
      if (changed){
        $.post('/mapcss2imgs', {"mapcss":editor.getSession().getValue(), "action":"save", "file":"preview" },function(data) {
          $.notify({
            title: 'MapCSS editor',
            message: 'Stylesheet saved on server.',
            timeout: 2000,
            useFallback: true
          });
          changed = false;
        });
      }
      else{
        
      }

    };
</script>



</body>
</html>
